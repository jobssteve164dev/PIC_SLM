# è¶…å‚æ•°ä¼ é€’é“¾å®Œæ•´æ€§ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2025-01-07 08:32:55  
**ä¿®å¤ç±»å‹**: ç³»ç»Ÿå®Œæ•´æ€§ä¿®å¤  
**å½±å“èŒƒå›´**: è®­ç»ƒå‚æ•°æ”¶é›†ã€ä¿å­˜ã€å¯¹æ¯”ã€æ—¥å¿—è®°å½•  

## é—®é¢˜å‘ç°

ç”¨æˆ·å‘ç°è®­ç»ƒæ—¥å¿—æ˜¾ç¤ºåªæ¥æ”¶äº†30ä¸ªå‚æ•°ï¼Œè€Œé¢„æœŸåº”è¯¥æœ‰46ä¸ªå‚æ•°ï¼ˆåŸºç¡€30ä¸ª + ç¬¬ä¸€é˜¶æ®µ9ä¸ª + ç¬¬äºŒé˜¶æ®µ7ä¸ªï¼‰ï¼Œè¿™è¡¨æ˜ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„é«˜çº§è¶…å‚æ•°æ²¡æœ‰è¢«å®Œæ•´ä¼ é€’ã€‚

### é—®é¢˜åˆ†æ

é€šè¿‡ç³»ç»Ÿæ€§æ£€æŸ¥å‘ç°å‚æ•°ä¼ é€’é“¾ä¸­å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ä¸»æ–‡ä»¶é—®é¢˜**: `src/main.py`ä¸­çš„`prepare_training_config()`æ–¹æ³•æ²¡æœ‰åŒ…å«ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„é«˜çº§è¶…å‚æ•°
2. **è®­ç»ƒçº¿ç¨‹éªŒè¯ä¸å®Œæ•´**: å‚æ•°éªŒè¯æ—¥å¿—ç¼ºå°‘ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µå‚æ•°çš„æ˜¾ç¤º
3. **å‚æ•°å¯¹æ¯”ç»„ä»¶ä¸å®Œæ•´**: é‡è¦å‚æ•°åˆ—è¡¨ç¼ºå°‘ç¬¬äºŒé˜¶æ®µå‚æ•°

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ä¸»æ–‡ä»¶å‚æ•°æ”¶é›†

**æ–‡ä»¶**: `src/main.py`
**æ–¹æ³•**: `prepare_training_config()`

```python
# ç¬¬ä¸€é˜¶æ®µé«˜çº§è¶…å‚æ•°
'beta1': params.get('beta1', 0.9),
'beta2': params.get('beta2', 0.999),
'momentum': params.get('momentum', 0.9),
'nesterov': params.get('nesterov', False),
'warmup_steps': params.get('warmup_steps', 0),
'warmup_ratio': params.get('warmup_ratio', 0.0),
'warmup_method': params.get('warmup_method', 'linear'),
'min_lr': params.get('min_lr', 1e-6),
'label_smoothing': params.get('label_smoothing', 0.0),

# ç¬¬äºŒé˜¶æ®µé«˜çº§è¶…å‚æ•°
'model_ema': params.get('model_ema', False),
'model_ema_decay': params.get('model_ema_decay', 0.9999),
'gradient_accumulation_steps': params.get('gradient_accumulation_steps', 1),
'cutmix_prob': params.get('cutmix_prob', 0.0),
'mixup_alpha': params.get('mixup_alpha', 0.0),
'loss_scale': params.get('loss_scale', 'dynamic'),
'static_loss_scale': params.get('static_loss_scale', 128.0),
```

### 2. å¢å¼ºè®­ç»ƒçº¿ç¨‹å‚æ•°éªŒè¯

**æ–‡ä»¶**: `src/training_components/training_thread.py`
**æ–¹æ³•**: `run()`

å¢åŠ äº†ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µå‚æ•°çš„è¯¦ç»†éªŒè¯æ—¥å¿—ï¼š

```python
# ç¬¬ä¸€é˜¶æ®µé«˜çº§è¶…å‚æ•°
print("\nğŸ”§ ç¬¬ä¸€é˜¶æ®µé«˜çº§è¶…å‚æ•°:")
stage_one_params = ['beta1', 'beta2', 'momentum', 'nesterov', 'warmup_steps', 
                  'warmup_ratio', 'warmup_method', 'min_lr', 'label_smoothing']

# ç¬¬äºŒé˜¶æ®µé«˜çº§è¶…å‚æ•°  
print("\nâš¡ ç¬¬äºŒé˜¶æ®µé«˜çº§è¶…å‚æ•°:")
stage_two_params = ['model_ema', 'model_ema_decay', 'gradient_accumulation_steps',
                  'cutmix_prob', 'mixup_alpha', 'loss_scale', 'static_loss_scale']
```

### 3. å®Œå–„å‚æ•°å¯¹æ¯”ç»„ä»¶

**æ–‡ä»¶**: `src/ui/components/evaluation/widgets/params_comparison_widget.py`
**æ–¹æ³•**: `update_params_table()`

åœ¨é‡è¦å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ ç¬¬äºŒé˜¶æ®µå‚æ•°ï¼š

```python
# ç¬¬äºŒé˜¶æ®µé«˜çº§è¶…å‚æ•°
'model_ema', 'model_ema_decay',
'gradient_accumulation_steps', 
'cutmix_prob', 'mixup_alpha',
'loss_scale', 'static_loss_scale',
```

## å‚æ•°ä¼ é€’é“¾éªŒè¯

### å®Œæ•´çš„å‚æ•°ä¼ é€’æµç¨‹

1. **UIç»„ä»¶å±‚** â†’ `AdvancedHyperparametersWidget.get_config()`
   - âœ… è¿”å›ç¬¬ä¸€é˜¶æ®µ9ä¸ªå‚æ•°
   - âœ… è¿”å›ç¬¬äºŒé˜¶æ®µ7ä¸ªå‚æ•°

2. **è®­ç»ƒç»„ä»¶å±‚** â†’ `ClassificationTrainingWidget.get_training_params()`
   - âœ… è°ƒç”¨`advanced_hyperparams_widget.get_config()`
   - âœ… é€šè¿‡`params.update(advanced_config)`åˆå¹¶å‚æ•°

3. **ä¸»æ–‡ä»¶å±‚** â†’ `prepare_training_config()`
   - âœ… ä»è®­ç»ƒç»„ä»¶è·å–æ‰€æœ‰å‚æ•°
   - âœ… é€šè¿‡`params.get()`å®‰å…¨è·å–ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µå‚æ•°

4. **è®­ç»ƒçº¿ç¨‹å±‚** â†’ `TrainingThread.run()`
   - âœ… æ¥æ”¶å®Œæ•´çš„è®­ç»ƒé…ç½®
   - âœ… åœ¨éªŒè¯æ—¥å¿—ä¸­æ˜¾ç¤ºæ‰€æœ‰å‚æ•°ç±»åˆ«

5. **æ—¥å¿—è®°å½•å±‚** â†’ `TensorBoardLogger.log_hyperparameters()`
   - âœ… è®°å½•æ‰€æœ‰ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µå‚æ•°

6. **å‚æ•°å¯¹æ¯”å±‚** â†’ `ParamsComparisonWidget.update_params_table()`
   - âœ… æ˜¾ç¤ºæ‰€æœ‰ä¿å­˜çš„å‚æ•°é…ç½®

### å‚æ•°æ•°é‡éªŒè¯

- **åŸºç¡€è®­ç»ƒå‚æ•°**: 30ä¸ª
- **ç¬¬ä¸€é˜¶æ®µé«˜çº§è¶…å‚æ•°**: 9ä¸ª
  - beta1, beta2, momentum, nesterov
  - warmup_steps, warmup_ratio, warmup_method
  - min_lr, label_smoothing
- **ç¬¬äºŒé˜¶æ®µé«˜çº§è¶…å‚æ•°**: 7ä¸ª
  - model_ema, model_ema_decay
  - gradient_accumulation_steps
  - cutmix_prob, mixup_alpha
  - loss_scale, static_loss_scale
- **é¢„æœŸå‚æ•°æ€»æ•°**: 46ä¸ª

## æŠ€æœ¯ç‰¹ç‚¹

### 1. å‘åå…¼å®¹æ€§
- æ‰€æœ‰æ–°å¢å‚æ•°éƒ½æœ‰åˆç†çš„é»˜è®¤å€¼
- ä¸ä¼šå½±å“ç°æœ‰çš„è®­ç»ƒæµç¨‹
- å‚æ•°è·å–ä½¿ç”¨`params.get()`æ–¹æ³•ï¼Œç¡®ä¿å®‰å…¨æ€§

### 2. å®Œæ•´æ€§ä¿è¯
- æ¯ä¸ªç»„ä»¶éƒ½åŒ…å«å®Œæ•´çš„å‚æ•°ä¼ é€’é€»è¾‘
- å‚æ•°éªŒè¯æ—¥å¿—æä¾›è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
- å‚æ•°å¯¹æ¯”åŠŸèƒ½æ”¯æŒæ–°å¢çš„æ‰€æœ‰å‚æ•°

### 3. å¯è¿½æº¯æ€§
- TensorBoardæ—¥å¿—è®°å½•æ‰€æœ‰è¶…å‚æ•°
- å‚æ•°é…ç½®æ–‡ä»¶ä¿å­˜å®Œæ•´çš„è®­ç»ƒé…ç½®
- è®­ç»ƒæ—¥å¿—æ˜¾ç¤ºè¯¦ç»†çš„å‚æ•°æ¥æ”¶æƒ…å†µ

## ä¿®å¤éªŒè¯

### é¢„æœŸæ”¹è¿›æ•ˆæœ

1. **è®­ç»ƒæ—¥å¿—æ˜¾ç¤º**: ä»30ä¸ªå‚æ•°å¢åŠ åˆ°46ä¸ªå‚æ•°
2. **å‚æ•°ç»Ÿè®¡è¯¦æƒ…**: æ˜¾ç¤ºæ¯ä¸ªé˜¶æ®µçš„å‚æ•°æ•°é‡
3. **é…ç½®æ–‡ä»¶å®Œæ•´æ€§**: ä¿å­˜çš„å‚æ•°é…ç½®åŒ…å«æ‰€æœ‰æ–°å¢å‚æ•°
4. **å‚æ•°å¯¹æ¯”åŠŸèƒ½**: æ”¯æŒå¯¹æ¯”ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„æ‰€æœ‰å‚æ•°

### éªŒè¯æ–¹æ³•

å¯åŠ¨ä¸€æ¬¡è®­ç»ƒåï¼Œåº”è¯¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°ï¼š
```
âœ… å‚æ•°æ¥æ”¶éªŒè¯å®Œæˆï¼Œå…±æ¥æ”¶ 46 ä¸ªå‚æ•°
   ğŸ“‹ åŸºç¡€å‚æ•°: 8ä¸ª
   ğŸ”§ é«˜çº§å‚æ•°: 11ä¸ª
   ğŸ—ï¸ é¢„è®­ç»ƒå‚æ•°: 4ä¸ª
   âš–ï¸ æƒé‡å‚æ•°: 4ä¸ª
   ğŸ”§ ç¬¬ä¸€é˜¶æ®µè¶…å‚æ•°: 9ä¸ª
   âš¡ ç¬¬äºŒé˜¶æ®µè¶…å‚æ•°: 7ä¸ª
   ğŸ’¾ èµ„æºå‚æ•°: 4ä¸ª
   ğŸ“ ç›®å½•å‚æ•°: 2ä¸ª
```

## ç»“è®º

é€šè¿‡ç³»ç»Ÿæ€§ä¿®å¤å‚æ•°ä¼ é€’é“¾ï¼Œç¡®ä¿äº†ç¬¬äºŒé˜¶æ®µè¶…å‚æ•°ä¼˜åŒ–åŠŸèƒ½çš„å®Œæ•´æ€§ï¼š

- âœ… **å‚æ•°æ”¶é›†å®Œæ•´**: æ‰€æœ‰ç»„ä»¶éƒ½èƒ½æ­£ç¡®æ”¶é›†å’Œä¼ é€’é«˜çº§è¶…å‚æ•°
- âœ… **é…ç½®ä¿å­˜å®Œæ•´**: è®­ç»ƒé…ç½®æ–‡ä»¶åŒ…å«æ‰€æœ‰ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µå‚æ•°
- âœ… **æ—¥å¿—è®°å½•å®Œæ•´**: TensorBoardå’Œè®­ç»ƒæ—¥å¿—è®°å½•æ‰€æœ‰è¶…å‚æ•°
- âœ… **å¯¹æ¯”åŠŸèƒ½å®Œæ•´**: å‚æ•°å¯¹æ¯”ç»„ä»¶æ”¯æŒæ‰€æœ‰æ–°å¢å‚æ•°

è¿™ç¡®ä¿äº†ç”¨æˆ·å¯ä»¥å®Œæ•´åœ°ä½¿ç”¨ç¬¬äºŒé˜¶æ®µçš„æ‰€æœ‰é«˜çº§ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ¨¡å‹EMAã€æ¢¯åº¦ç´¯ç§¯ã€é«˜çº§æ•°æ®å¢å¼ºå’ŒæŸå¤±ç¼©æ”¾ç­‰åŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒäº†ç³»ç»Ÿçš„å‘åå…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚ 