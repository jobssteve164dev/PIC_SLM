# 自动Review组件说明文档

## 功能概述

自动Review组件是一个独立的后台服务，用于自动监控生产线上的AOI测试结果，并进行智能缺陷分类。该组件集成在模型预测标签页中，作为第三种预测模式运行。

## 核心功能

### 1. 文件监控
- 自动监控 `\\192.168.129.25\ScanResults` 目录下的新文件
- 按照设定的时间间隔（默认10秒）进行扫描
- 支持暂停和恢复监控服务

### 2. 智能分类
- 基于已加载的AI模型进行缺陷分类
- 支持置信度阈值设置，只有达到阈值的预测才会被分类
- 实时显示分类结果和统计信息

### 3. 自动文件整理
- 根据分类结果自动创建目录结构：`Job\Lot ID\缺陷类别`
- 支持文件复制或移动操作
- 自动处理重名文件，添加序号避免冲突

### 4. 实时监控
- 提供实时运行状态监控
- 详细的操作日志记录
- 统计信息展示（处理总数、分类数、错误数等）

## 使用说明

### 第一步：加载模型
1. 在预测标签页中选择并加载AI模型
2. 确保模型和类别信息文件正确加载

### 第二步：配置路径
1. 切换到"自动Review"模式
2. 在"配置设置"标签页中设置：
   - **扫描文件夹**: `\\192.168.129.25\ScanResults`
   - **Review文件夹**: `\\192.168.129.2\D:\01_AOI_ADC_Review(review)`
   - **输出文件夹**: 选择分类结果的输出目录

### 第三步：参数配置
- **扫描间隔**: 设置文件夹扫描间隔（1-3600秒）
- **置信度阈值**: 设置分类置信度阈值（0-100%）
- **文件操作**: 选择复制或移动文件
- **自动启动**: 可选择程序启动时自动开始

### 第四步：启动服务
1. 点击"开始自动Review"按钮
2. 切换到"运行监控"标签页查看状态
3. 在"统计信息"标签页查看处理统计

## 工作流程

### 1. 文件发现
```
ScanResults/
├── WaferID_001/
├── WaferID_002/
└── WaferID_003/
```

### 2. 文件处理
对于每个Wafer ID：
1. 在Review文件夹中查找对应的JPEG文件
2. 使用AI模型进行缺陷分类
3. 根据置信度决定是否分类

### 3. 结果输出
```
Output/
├── JobA/
│   ├── Lot001/
│   │   ├── 缺陷类别1/
│   │   │   ├── image1.jpg
│   │   │   └── image2.jpg
│   │   └── 缺陷类别2/
│   │       ├── image3.jpg
│   │       └── image4.jpg
│   └── Lot002/
│       └── 缺陷类别1/
│           └── image5.jpg
└── JobB/
    └── Lot001/
        └── 缺陷类别3/
            └── image6.jpg
```

## 配置文件

### 保存配置
使用"保存配置"按钮将当前设置保存为JSON文件，方便重复使用。

### 加载配置
使用"加载配置"按钮从JSON文件加载之前保存的配置。

### 配置文件格式
```json
{
  "scan_folder": "\\\\192.168.129.25\\ScanResults",
  "review_folder": "\\\\192.168.129.2\\D:\\01_AOI_ADC_Review(review)",
  "output_folder": "D:\\AutoReview_Output",
  "scan_interval": 10,
  "confidence_threshold": 80.0,
  "copy_mode": "copy",
  "auto_start": false
}
```

## 独立线程设计

### 线程安全
- 使用QMutex确保线程安全
- 支持暂停/恢复/停止操作
- 异常处理和错误恢复

### 性能优化
- 避免重复处理已处理的文件
- 批量处理提高效率
- 内存使用优化

### 状态管理
- 实时状态更新
- 详细的操作日志
- 错误跟踪和报告

## 监控界面

### 运行状态
- 服务状态显示
- 实时进度条
- 详细操作日志

### 统计信息
- 总处理数量
- 分类成功数量
- 置信度不足数量
- 错误数量
- 运行时间
- 各类别分类统计

## 注意事项

### 1. 网络路径
确保网络路径可访问，特别是：
- `\\192.168.129.25\ScanResults`
- `\\192.168.129.2\D:\01_AOI_ADC_Review(review)`

### 2. 权限设置
确保程序有足够的权限：
- 读取扫描文件夹权限
- 读取Review文件夹权限
- 写入输出文件夹权限

### 3. 模型兼容性
- 确保使用的AI模型适用于缺陷检测
- 类别信息文件必须与实际缺陷类型匹配
- 建议使用高置信度阈值以确保分类准确性

### 4. 性能考虑
- 根据实际情况调整扫描间隔
- 监控系统资源使用情况
- 定期清理日志文件

## 错误处理

### 常见错误
1. **文件夹不存在**: 检查网络连接和路径设置
2. **权限不足**: 检查文件夹访问权限
3. **模型未加载**: 确保在预测标签页中正确加载模型
4. **置信度过低**: 调整置信度阈值或重新训练模型

### 错误恢复
- 系统会自动重试失败的操作
- 详细的错误日志记录
- 不会因单个文件错误而停止整个服务

## 扩展功能

### 自定义命名规则
可以根据实际需求修改Wafer ID解析逻辑，在`_extract_job_lot_from_wafer`方法中自定义。

### 多种文件格式支持
目前支持JPG和JPEG格式，可以轻松扩展支持其他图片格式。

### 通知功能
可以扩展添加邮件通知、消息推送等功能。 