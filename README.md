# 半导体芯片缺陷检测系统

## 项目概述

本系统是一个用于半导体芯片AOI（自动光学检测）缺陷图像分类和检测的综合工具，提供了从图像预处理、数据标注到模型训练和预测的完整解决方案。系统采用PyQt5构建图形界面，使用PyTorch深度学习框架进行模型训练，支持多种预训练模型和数据增强方法。

## 功能特点

### 1. 图像预处理
- 批量调整图像尺寸和格式（支持224x224、256x256等多种尺寸）
- 亮度和对比度自动调整
- 自动创建训练集和验证集（可配置比例）
- 多级数据增强（基础/中等/强化）
- 支持JPG、PNG、BMP等多种图像格式转换

### 2. 图像标注
- 支持LabelImg（矩形标注）和LabelMe（多边形标注）工具
- 自动安装标注工具（如未安装）
- 缺陷类别管理（添加、删除、编辑）
- 预定义类别文件生成
- 标注结果自动保存和加载

### 3. 模型训练
- 支持分类和检测两种任务类型
- 分类模型：ResNet18/ResNet50/EfficientNet等
- 检测模型：YOLOv5/Faster R-CNN/SSD等
- 可调整训练参数：
  - 批次大小（Batch Size）
  - 学习率（Learning Rate）
  - 训练轮数（Epochs）
  - 优化器（Optimizer）：Adam/SGD/RMSprop
  - 学习率调度器（LR Scheduler）
  - 权重衰减（Weight Decay）
- 实时训练进度和精度可视化
- 支持多种评估指标：
  - 分类：准确率（Accuracy）、精确率（Precision）、召回率（Recall）、F1分数
  - 检测：mAP、mAP_50、mAP_75、FPS
- 自动保存最佳模型
- 支持预训练模型微调

### 4. 缺陷预测
- 单张图像预测
- 批量图像预测
- 显示多个可能的缺陷类别及其概率
- 可视化预测结果（热力图、边界框等）
- 支持导出预测结果

## 系统要求

- Python 3.7+
- PyTorch 1.7.0+
- PyQt5 5.15.0+
- Windows/Linux/MacOS
- CUDA支持（可选，用于GPU加速）

## 安装说明

1. 克隆或下载本项目

2. 安装依赖包
```bash
pip install -r requirements.txt
```

3. 运行程序
```bash
python src/main.py
```

## 使用指南

### 1. 数据处理

1. 选择包含原始图像的源文件夹
2. 选择输出根目录（系统将自动创建子目录）
3. 设置图像处理参数：
   - 目标尺寸（224x224、256x256等或自定义）
   - 目标格式（JPG/PNG/BMP）
   - 亮度和对比度调整
4. 设置数据集参数：
   - 训练集比例（默认0.8）
   - 数据增强级别（基础/中等/强化）
5. 点击"开始处理数据"
6. 处理完成后，点击"进入图片标注"

### 2. 图像标注

1. 选择标注工具（LabelImg或LabelMe）
2. 添加缺陷类别（系统预设了常见的缺陷类型：划痕、污点、缺失、变形、异物）
3. 点击"启动标注工具"
4. 在打开的标注工具中标注图像
5. 保存标注结果
6. 标注完成后，可直接进入模型训练阶段

### 3. 模型训练

1. 选择任务类型（分类或检测）
2. 选择标注数据文件夹
3. 选择模型类型
4. 设置训练参数：
   - 批次大小
   - 学习率
   - 训练轮数
   - 优化器
   - 学习率调度器
   - 权重衰减
   - 是否使用预训练模型
5. 选择评估指标
6. 点击"开始训练"
7. 训练过程中可实时查看进度、损失曲线和评估指标

### 4. 缺陷预测

1. 选择要预测的图像或文件夹
2. 选择使用的模型
3. 设置预测参数（如置信度阈值）
4. 点击"开始预测"
5. 查看预测结果
6. 可选择导出预测结果

## 项目结构

```
semiconductor_defect_detection/
├── config/                # 配置文件目录
│   └── config.yaml        # 主配置文件（包含默认参数）
├── data/                  # 数据目录
│   ├── raw/               # 原始图像
│   └── processed/         # 处理后的图像
├── models/                # 模型目录
│   └── saved_models/      # 保存的模型
├── src/                   # 源代码
│   ├── ui/                # 用户界面
│   │   ├── __init__.py
│   │   ├── main_window.py         # 主窗口
│   │   ├── annotation_widget.py   # 标注界面
│   │   └── training_visualization.py # 训练可视化
│   ├── __init__.py
│   ├── main.py            # 主程序
│   ├── data_processor.py  # 数据处理
│   ├── image_preprocessor.py # 图像预处理
│   ├── annotation_tool.py # 标注工具
│   ├── model_trainer.py   # 模型训练
│   ├── predictor.py       # 预测
│   └── config_loader.py   # 配置加载
└── requirements.txt       # 依赖包
```

## 配置文件说明

系统使用YAML格式的配置文件（config/config.yaml）存储默认设置，包括：

- 缺陷类别列表
- 默认路径设置
- 预处理参数
- 训练参数

用户可以通过界面修改这些设置，修改后的设置会自动保存。

## 依赖库

主要依赖库包括：
- torch/torchvision：深度学习框架
- PyQt5：图形界面
- Pillow/OpenCV：图像处理
- albumentations：数据增强
- matplotlib：可视化
- scikit-learn：评估指标计算
- tensorboard：训练监控
- efficientnet-pytorch：EfficientNet模型
- labelImg/labelme：标注工具

## 注意事项

1. 首次使用标注工具时，系统会自动安装相应的工具，请确保网络连接正常
2. 对于大量图像，预处理和训练可能需要较长时间，请耐心等待
3. 训练模型时，如有GPU将自动使用，可大幅提升训练速度
4. 建议使用统一尺寸和格式的图像进行训练，以获得更好的效果
5. 系统会自动保存训练过程中的最佳模型，可在预测时选择使用
6. 对于检测任务，建议使用LabelImg进行矩形标注；对于需要精确轮廓的场景，建议使用LabelMe进行多边形标注

## 开发者信息

本系统基于Python开发，使用PyQt5构建图形界面，PyTorch作为深度学习框架。系统采用模块化设计，各组件之间通过信号槽机制通信，便于扩展和维护。如需进一步开发或定制，请参考源代码中的注释说明。

## 许可证

MIT License 